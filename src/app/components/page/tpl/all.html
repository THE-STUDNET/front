<div infinite-list="ctrl.searched_all || ctrl.users.all" 
     loaded="ctrl.all_loaded" 
     distance="2000"
     model="ctrl.user_model" class="default users"
     pagination="36" >
    <div class="user middle" ng-if=" (ctrl.searched_all || ctrl.users.all).indexOf(PageCtrl.me) >= 0" 
         user="PageCtrl.me" user-links="true">
        <div class="user_state" ng-if="ctrl.users.administrators.indexOf(PageCtrl.me) >= 0">Administrator</div>
        <div class="user_state" ng-if="ctrl.users.members.indexOf(PageCtrl.me) >= 0">Attendee</div>
        <div class="user_state" ng-if="ctrl.users.invited.indexOf(PageCtrl.me) >= 0">Invited</div>
        <div class="user_state" ng-if="ctrl.users.pending.indexOf(PageCtrl.me) >= 0">Pending</div>
    </div>
    <div class="user middle" ng-if="ctrl.user_model.list[user].datum && user !== PageCtrl.me"
         ng-repeat="user in (ctrl.searched_all || ctrl.users.all) | limitTo : ctrl.all_loaded" user="user" user-links="true">
         
        <div class="user_state" ng-if="ctrl.users.administrators.indexOf(user) >= 0">Administrator</div>
        <div class="user_state" ng-if="ctrl.users.members.indexOf(user) >= 0">Attendee</div>
        <div class="user_state" ng-if="ctrl.users.invited.indexOf(user) >= 0">Invited</div>
        <div class="user_state" ng-if="ctrl.users.pending.indexOf(user) >= 0">Pending</div>
        <div class="cty_actions">
            <button class="i16 i-comment" ng-click="ctrl.openConversation(user)"
                    title="Start chatting with {{ ::ctrl.user_model.list[user].datum|username }}">
                <span class="for_screen_reader">Start chatting with {{ ::ctrl.user_model.list[user].datum|username }}</span>
            </button>
            <cnctactions
                connection="ctrl.user_model.list[user].datum"></cnctactions>
            <button class="action i16 i-mail" ng-if="PageCtrl.editable && ctrl.page.datum.type === 'organization'" 
                    ng-click="ctrl.sendPassword(user)" title="Send invitation"
                    ng-class="{ green : ctrl.user_model.list[user].datum.email_sent }">
            </button>
             <div class="right" dropdown ng-if="PageCtrl.editable">
                <button class="action i16 i-more" title="" data=""
                        dropdown-toggle >
                    <span class="for_screen_reader"></span>
                </button>
                <div dropdown-content class="hdr_ddcontent">
                    <button ng-if="ctrl.users.administrators.indexOf(user) !== -1" 
                            ng-click="ctrl.page_users.removeAdmin(ctrl.page.datum.id, user)"><b>Remove</b> administrator rights</button>
                    <button ng-if="ctrl.users.administrators.indexOf(user) === -1" 
                            ng-click="ctrl.page_users.grantAdmin(ctrl.page.datum.id, user)"><b>Grant</b> administrator rights</button>
                    <button ng-if="ctrl.users.pending.indexOf(user) === -1 && ctrl.users.invited.indexOf(user) === -1" 
                            ng-click="ctrl.page_users.remove(ctrl.page.datum.id, user)"><b>Remove</b> from this {{ ctrl.page_label }} </button>
                    <button ng-if="ctrl.users.pending.indexOf(user) !== -1 && ctrl.page.datum.type !== 'organization'" 
                            ng-click="ctrl.page_users.accept(ctrl.page.datum.id, user)"><b>Accept</b> pending request</button>
                    <button ng-if="ctrl.users.pending.indexOf(user) !== -1 && ctrl.page.datum.type !== 'organization'" 
                            ng-click="ctrl.page_users.decline(ctrl.page.datum.id, user)"><b>Decline</b> pending request</button>
                    <button ng-if="ctrl.users.invited.indexOf(user) !== -1 && ctrl.page.datum.type !== 'organization'" 
                            ng-click="ctrl.page_users.decline(ctrl.page.datum.id, user)"><b>Cancel</b> invitation</button>
                    <button ng-if="ctrl.users.pending.indexOf(user) >= 0 && ctrl.page.datum.type === 'organization'" ng-click="ctrl.deleteUser(user)"><b>Cancel</b> invitation </button>
                </div>
            </div>
        </div>
    </div> 
</div>